{% load static %}
<html>

<head>

    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet"/>
    <link href='//fonts.googleapis.com/css?family=Lato:400,700&subset=latin,cyrillic,cyrillic-ext,vietnamese,latin-ext' rel='stylesheet' type='text/css'>
    <link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet" />
    <link href="{% static 'css/datepicker.css' %}" rel="stylesheet" />
    <link href="{% static 'css/bootstrap-timepicker.css' %}" rel="stylesheet" />
    <link href="{% static 'css/challenges.css' %}" rel="stylesheet" />
    <link href="{% static 'css/alertify.core.css' %}" rel="stylesheet" />
    <link href="{% static 'css/alertify.default.css' %}" rel="stylesheet" />

</head>

<body >


<!-- Main Content -->
<div class="container-fluid" style="margin: 2em">

    <div class="row">
        <div class="col-sm-12">
            <div class="col-sm-6">
                <h3>List of Challenges </h3>
            </div>
            <div class="col-sm-6 text-right">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#myModal">
                    <i class="fa fa-plus"></i> Add Challenge
                </button>

                <!-- Modal -->
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                    <div class="modal-dialog modal-md" role="document">
                        <div class="modal-content">
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1" style="float: left; color: blue">Title</label>
                                        <input class="form-control" id="challenge_name" placeholder="Enter title"/>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-refresh"></i> Close</button>
                                <button type="button" class="btn btn-primary" id="btnAddChallenge"><i class="fa fa-check"></i> Save</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <br/>

    <div class="row">
        <div class="col-sm-12">

            {% for challenge in challenges %}
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-sm-4">
                                <a data-toggle="collapse" data-parent="#accordion" href="#challenge_{{ challenge.id }}" style="color: white">
                                    <h4> {{ challenge.name }} ({{ challenge.code }})</h4>
                                </a>
                            </div>
                            <div class="col-sm-4"></div>
                            <div class="col-sm-4">
                                <a data-toggle="collapse" data-parent="#accordion" href="#challenge_{{ challenge.id }}" style="color: white">
                                <span style="float: right; font-size: 17px; margin-top: 0.5em">
                                   <i class="glyphicon glyphicon-chevron-down"></i>
                                </span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <!-- Question List de cada Challenge -->
                    <div id="challenge_{{ challenge.id }}" class="panel-collapse collapse">
                        <div class="panel-body">

                            {% for question in challenge.get_my_questions %}
                                <div class="main-questions-list">
                                    <div class="panel-group">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h4>
                                                    <a data-toggle="collapse" href="#question_{{ question.id }}">
                                                        Question {{ question.order }}
                                                        <span style="float: right">
                                                            <i class="glyphicon glyphicon-chevron-down"></i>
                                                        </span>
                                                    </a>
                                                </h4>
                                            </div>
                                            <div id="question_{{ question.id }}" class="panel-collapse collapse">
                                                <div class="panel-body">

                                                    <div itemprop="item">
                                                        <div class="col-md-9 col-xs-9 q-left-content">

                                                            <div class="q-ltop-content">
                                                                <h2 itemprop="name">
                                                                    <a itemprop="url" href="#" class="question-title">
                                                                        {{ question.text }}
                                                                    </a>
                                                                </h2>
                                                            </div>

                                                            <div style="padding-top: 2em">

                                                                <table class="table">
                                                                    <tbody>

                                                                    <tr>
                                                                        <td style="width: 20px">1</td>
                                                                        <td>{{ question.answer1 }}</td>
                                                                        <td style="width: 20px">
                                                                            {% if question.is_correct_answer1 %}
                                                                                <i style="color: green; margin-right: 1em" class="glyphicon glyphicon-ok"></i>
                                                                            {% else %}
                                                                                <i style="color: red; margin-right: 1em" class="glyphicon glyphicon-remove"></i>
                                                                            {% endif %}
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>2</td>
                                                                        <td>{{ question.answer2 }}</td>
                                                                        <td>
                                                                            {% if question.is_correct_answer2 %}
                                                                                <i style="color: green; margin-right: 1em" class="glyphicon glyphicon-ok"></i>
                                                                            {% else %}
                                                                                <i style="color: red; margin-right: 1em" class="glyphicon glyphicon-remove"></i>
                                                                            {% endif %}
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>3</td>
                                                                        <td>{{ question.answer3 }}</td>
                                                                        <td>
                                                                            {% if question.is_correct_answer3 %}
                                                                                <i style="color: green; margin-right: 1em" class="glyphicon glyphicon-ok"></i>
                                                                            {% else %}
                                                                                <i style="color: red; margin-right: 1em" class="glyphicon glyphicon-remove"></i>
                                                                            {% endif %}
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>4</td>
                                                                        <td>{{ question.answer4 }}</td>
                                                                        <td>
                                                                            {% if question.is_correct_answer4 %}
                                                                                <i style="color: green; margin-right: 1em" class="glyphicon glyphicon-ok"></i>
                                                                            {% else %}
                                                                                <i style="color: red; margin-right: 1em" class="glyphicon glyphicon-remove"></i>
                                                                            {% endif %}
                                                                        </td>
                                                                    </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>

                                                        <!-- Right Side with Stats -->
                                                        <div class="col-md-3 col-xs-3 q-right-content">
                                                            <div style="float: right">
                                                                <a class="btn btn-primary" href="{% url 'challenges' %}?action=edit_question&id={{ question.id }}">
                                                                    <i class="glyphicon glyphicon-edit"></i> Edit
                                                                </a>
                                                                <a class="btn btn-danger" style="margin-left: 0.5em" href="{% url 'challenges' %}?action=delete_question&id={{ question.id }}">
                                                                    <i class="glyphicon glyphicon-remove"></i> Delete
                                                                </a>
                                                            </div>

                                                            <div class="clearfix"></div>
                                                            <br/><br/><br/>

                                                            <ul class="question-statistic">
                                                                <li class="active">
                                                                    <span class="question-views">17 </span> Views
                                                                </li>
                                                                <li class="active">
                                                                    <span itemprop="answerCount" class="question-answers">2 </span>Correct</li>
                                                                <li class="active">
                                                                    <span itemprop="upvoteCount" class="question-votes">0 </span> Incorrect
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="clearfix"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            <div class="text-right">
                                <a class="btn btn-primary" href="{% url 'challenges' %}?action=add_question&id={{ challenge.id }}">
                                    <i class="glyphicon glyphicon-plus"></i> Add Question
                                </a>
                            </div>


                        </div>

                    </div> <!-- end of challenge -->

                </div> <!-- end panel primary -->
            {% endfor %}

        </div>

    </div>

</div> <!-- end container fluid -->


<script src="{% static 'js/jquery-2.1.3.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'js/alertify.min.js' %}"></script>

<script>

    $(function () {

        $("#btnAddChallenge").click(function () {

            var challenge_name = $("#challenge_name").val();

            if (challenge_name){
                $.ajax({
                    type: "POST",
                    url: "{% url 'challenges' %}",
                    data: {'action': 'create_challenge', 'challenge_name': challenge_name},
                    dataType: "json",
                    success: function(data) {
                        if (data.result === 'ok') {
                            alertify.success(data.message);
                            setTimeout(function () {
                                location.reload();
                            }, 3000);
                        } else {
                            alertify.error(data.message);
                        }
                    },
                    error: function() {
                        alertify.error("Error saving data");
                    }

                });
            }

            $("#myModal").modal('hide');

        });

    });

</script>

</body>

</html>

